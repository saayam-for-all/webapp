{"version":3,"file":"accessible-name-and-description.mjs","names":["ArrayFrom","SetLike","hasAnyConcreteRoles","isElement","isHTMLTableCaptionElement","isHTMLInputElement","isHTMLSelectElement","isHTMLTextAreaElement","safeWindow","isHTMLFieldSetElement","isHTMLLegendElement","isHTMLOptGroupElement","isHTMLTableElement","isHTMLSlotElement","isSVGSVGElement","isSVGTitleElement","queryIdRefs","getLocalName","presentationRoles","asFlatString","s","trim","replace","isHidden","node","getComputedStyleImplementation","hasAttribute","getAttribute","style","getPropertyValue","isControl","hasAbstractRole","role","TypeError","concat","querySelectorAllSubtree","element","selectors","elements","querySelectorAll","forEach","root","push","apply","querySelectedOptions","listbox","selectedOptions","isMarkedPresentational","isNativeHostLanguageTextAlternativeElement","allowsNameFromContent","isDescendantOfNativeHostLanguageTextAlternativeElement","getValueOfTextbox","value","textContent","getTextualContent","declaration","content","test","slice","isLabelableElement","localName","findLabelableElement","labelableElement","childNodes","childNode","descendantLabelableElement","getControlOfLabel","label","control","undefined","htmlFor","ownerDocument","getElementById","getLabels","labelsProperty","labels","document","filter","getSlotContents","slot","assignedNodes","length","computeTextAlternative","options","arguments","consultedNodes","computedStyles","Map","window","_options$compute","compute","_options$computedStyl","computedStyleSupportsPseudoElements","getComputedStyle","_options$getComputedS","uncachedGetComputedStyle","bind","_options$hidden","hidden","el","pseudoElement","Error","cachedStyles","get","set","computeMiscTextAlternative","context","accumulatedText","pseudoBefore","beforeContent","child","result","isEmbeddedInLabel","isReferenced","recursion","display","separator","pseudoAfter","afterContent","useAttribute","attributeName","attribute","getAttributeNode","has","add","computeTooltipAttributeValue","computeElementTextAlternative","children","i","nameFromAlt","nameFromLabel","type","nameFromValue","map","join","nameFromTitle","nameFromSubTree","current","labelAttributeNode","labelElements","skipToStep2E","ariaLabel","elementTextAlternative","selectedOption","accumulatedText2F","nodeType","TEXT_NODE","tooltipAttributeValue"],"sources":["../sources/accessible-name-and-description.ts"],"sourcesContent":["/**\n * implements https://w3c.github.io/accname/\n */\nimport ArrayFrom from \"./polyfills/array.from\";\nimport SetLike from \"./polyfills/SetLike\";\nimport {\n\thasAnyConcreteRoles,\n\tisElement,\n\tisHTMLTableCaptionElement,\n\tisHTMLInputElement,\n\tisHTMLSelectElement,\n\tisHTMLTextAreaElement,\n\tsafeWindow,\n\tisHTMLFieldSetElement,\n\tisHTMLLegendElement,\n\tisHTMLOptGroupElement,\n\tisHTMLTableElement,\n\tisHTMLSlotElement,\n\tisSVGSVGElement,\n\tisSVGTitleElement,\n\tqueryIdRefs,\n\tgetLocalName,\n\tpresentationRoles,\n} from \"./util\";\n\n/**\n *  A string of characters where all carriage returns, newlines, tabs, and form-feeds are replaced with a single space, and multiple spaces are reduced to a single space. The string contains only character data; it does not contain any markup.\n */\ntype FlatString = string & {\n\t__flat: true;\n};\ntype GetComputedStyle = typeof window.getComputedStyle;\n\n/**\n * interface for an options-bag where `window.getComputedStyle` can be mocked\n */\nexport interface ComputeTextAlternativeOptions {\n\tcompute?: \"description\" | \"name\";\n\t/**\n\t * Set to true if window.computedStyle supports the second argument.\n\t * This should be false in JSDOM. Otherwise JSDOM will log console errors.\n\t */\n\tcomputedStyleSupportsPseudoElements?: boolean;\n\t/**\n\t * mock window.getComputedStyle. Needs `content`, `display` and `visibility`\n\t */\n\tgetComputedStyle?: GetComputedStyle;\n\t/**\n\t * Set to `true` if you want to include hidden elements in the accessible name and description computation.\n\t * Skips 2A in https://w3c.github.io/accname/#computation-steps.\n\t * @default false\n\t */\n\thidden?: boolean;\n}\n\n/**\n *\n * @param {string} string -\n * @returns {FlatString} -\n */\nfunction asFlatString(s: string): FlatString {\n\treturn s.trim().replace(/\\s\\s+/g, \" \") as FlatString;\n}\n\n/**\n *\n * @param node -\n * @param options - These are not optional to prevent accidentally calling it without options in `computeAccessibleName`\n * @returns {boolean} -\n */\nfunction isHidden(\n\tnode: Node,\n\tgetComputedStyleImplementation: GetComputedStyle,\n): node is Element {\n\tif (!isElement(node)) {\n\t\treturn false;\n\t}\n\n\tif (\n\t\tnode.hasAttribute(\"hidden\") ||\n\t\tnode.getAttribute(\"aria-hidden\") === \"true\"\n\t) {\n\t\treturn true;\n\t}\n\n\tconst style = getComputedStyleImplementation(node);\n\treturn (\n\t\tstyle.getPropertyValue(\"display\") === \"none\" ||\n\t\tstyle.getPropertyValue(\"visibility\") === \"hidden\"\n\t);\n}\n\n/**\n * @param {Node} node -\n * @returns {boolean} - As defined in step 2E of https://w3c.github.io/accname/#mapping_additional_nd_te\n */\nfunction isControl(node: Node): boolean {\n\treturn (\n\t\thasAnyConcreteRoles(node, [\"button\", \"combobox\", \"listbox\", \"textbox\"]) ||\n\t\thasAbstractRole(node, \"range\")\n\t);\n}\n\nfunction hasAbstractRole(node: Node, role: string): node is Element {\n\tif (!isElement(node)) {\n\t\treturn false;\n\t}\n\n\tswitch (role) {\n\t\tcase \"range\":\n\t\t\treturn hasAnyConcreteRoles(node, [\n\t\t\t\t\"meter\",\n\t\t\t\t\"progressbar\",\n\t\t\t\t\"scrollbar\",\n\t\t\t\t\"slider\",\n\t\t\t\t\"spinbutton\",\n\t\t\t]);\n\t\tdefault:\n\t\t\tthrow new TypeError(\n\t\t\t\t`No knowledge about abstract role '${role}'. This is likely a bug :(`,\n\t\t\t);\n\t}\n}\n\n/**\n * element.querySelectorAll but also considers owned tree\n * @param element\n * @param selectors\n */\nfunction querySelectorAllSubtree(\n\telement: Element,\n\tselectors: string,\n): Element[] {\n\tconst elements = ArrayFrom(element.querySelectorAll(selectors));\n\n\tqueryIdRefs(element, \"aria-owns\").forEach((root) => {\n\t\t// babel transpiles this assuming an iterator\n\t\telements.push.apply(elements, ArrayFrom(root.querySelectorAll(selectors)));\n\t});\n\n\treturn elements;\n}\n\nfunction querySelectedOptions(listbox: Element): ArrayLike<Element> {\n\tif (isHTMLSelectElement(listbox)) {\n\t\t// IE11 polyfill\n\t\treturn (\n\t\t\tlistbox.selectedOptions || querySelectorAllSubtree(listbox, \"[selected]\")\n\t\t);\n\t}\n\treturn querySelectorAllSubtree(listbox, '[aria-selected=\"true\"]');\n}\n\nfunction isMarkedPresentational(node: Node): node is Element {\n\treturn hasAnyConcreteRoles(node, presentationRoles);\n}\n\n/**\n * Elements specifically listed in html-aam\n *\n * We don't need this for `label` or `legend` elements.\n * Their implicit roles already allow \"naming from content\".\n *\n * sources:\n *\n * - https://w3c.github.io/html-aam/#table-element\n */\nfunction isNativeHostLanguageTextAlternativeElement(\n\tnode: Node,\n): node is Element {\n\treturn isHTMLTableCaptionElement(node);\n}\n\n/**\n * https://w3c.github.io/aria/#namefromcontent\n */\nfunction allowsNameFromContent(node: Node): boolean {\n\treturn hasAnyConcreteRoles(node, [\n\t\t\"button\",\n\t\t\"cell\",\n\t\t\"checkbox\",\n\t\t\"columnheader\",\n\t\t\"gridcell\",\n\t\t\"heading\",\n\t\t\"label\",\n\t\t\"legend\",\n\t\t\"link\",\n\t\t\"menuitem\",\n\t\t\"menuitemcheckbox\",\n\t\t\"menuitemradio\",\n\t\t\"option\",\n\t\t\"radio\",\n\t\t\"row\",\n\t\t\"rowheader\",\n\t\t\"switch\",\n\t\t\"tab\",\n\t\t\"tooltip\",\n\t\t\"treeitem\",\n\t]);\n}\n\n/**\n * TODO https://github.com/eps1lon/dom-accessibility-api/issues/100\n */\nfunction isDescendantOfNativeHostLanguageTextAlternativeElement(\n\t// eslint-disable-next-line @typescript-eslint/no-unused-vars -- not implemented yet\n\tnode: Node,\n): boolean {\n\treturn false;\n}\n\nfunction getValueOfTextbox(element: Element): string {\n\tif (isHTMLInputElement(element) || isHTMLTextAreaElement(element)) {\n\t\treturn element.value;\n\t}\n\t// https://github.com/eps1lon/dom-accessibility-api/issues/4\n\treturn element.textContent || \"\";\n}\n\nfunction getTextualContent(declaration: CSSStyleDeclaration): string {\n\tconst content = declaration.getPropertyValue(\"content\");\n\tif (/^[\"'].*[\"']$/.test(content)) {\n\t\treturn content.slice(1, -1);\n\t}\n\treturn \"\";\n}\n\n/**\n * https://html.spec.whatwg.org/multipage/forms.html#category-label\n * TODO: form-associated custom elements\n * @param element\n */\nfunction isLabelableElement(element: Element): boolean {\n\tconst localName = getLocalName(element);\n\n\treturn (\n\t\tlocalName === \"button\" ||\n\t\t(localName === \"input\" && element.getAttribute(\"type\") !== \"hidden\") ||\n\t\tlocalName === \"meter\" ||\n\t\tlocalName === \"output\" ||\n\t\tlocalName === \"progress\" ||\n\t\tlocalName === \"select\" ||\n\t\tlocalName === \"textarea\"\n\t);\n}\n\n/**\n * > [...], then the first such descendant in tree order is the label element's labeled control.\n * -- https://html.spec.whatwg.org/multipage/forms.html#labeled-control\n * @param element\n */\nfunction findLabelableElement(element: Element): Element | null {\n\tif (isLabelableElement(element)) {\n\t\treturn element;\n\t}\n\tlet labelableElement: Element | null = null;\n\telement.childNodes.forEach((childNode) => {\n\t\tif (labelableElement === null && isElement(childNode)) {\n\t\t\tconst descendantLabelableElement = findLabelableElement(childNode);\n\t\t\tif (descendantLabelableElement !== null) {\n\t\t\t\tlabelableElement = descendantLabelableElement;\n\t\t\t}\n\t\t}\n\t});\n\n\treturn labelableElement;\n}\n\n/**\n * Polyfill of HTMLLabelElement.control\n * https://html.spec.whatwg.org/multipage/forms.html#labeled-control\n * @param label\n */\nfunction getControlOfLabel(label: HTMLLabelElement): Element | null {\n\tif (label.control !== undefined) {\n\t\treturn label.control;\n\t}\n\n\tconst htmlFor = label.getAttribute(\"for\");\n\tif (htmlFor !== null) {\n\t\treturn label.ownerDocument.getElementById(htmlFor);\n\t}\n\n\treturn findLabelableElement(label);\n}\n\n/**\n * Polyfill of HTMLInputElement.labels\n * https://developer.mozilla.org/en-US/docs/Web/API/HTMLInputElement/labels\n * @param element\n */\nfunction getLabels(element: Element): HTMLLabelElement[] | null {\n\tconst labelsProperty = (element as HTMLInputElement).labels as\n\t\t| HTMLInputElement[\"labels\"]\n\t\t| undefined;\n\n\tif (labelsProperty === null) {\n\t\treturn labelsProperty;\n\t}\n\tif (labelsProperty !== undefined) {\n\t\treturn ArrayFrom(labelsProperty);\n\t}\n\n\t// polyfill\n\tif (!isLabelableElement(element)) {\n\t\treturn null;\n\t}\n\tconst document = element.ownerDocument;\n\n\treturn ArrayFrom(document.querySelectorAll(\"label\")).filter((label) => {\n\t\treturn getControlOfLabel(label) === element;\n\t});\n}\n\n/**\n * Gets the contents of a slot used for computing the accname\n * @param slot\n */\nfunction getSlotContents(slot: HTMLSlotElement): Node[] {\n\t// Computing the accessible name for elements containing slots is not\n\t// currently defined in the spec. This implementation reflects the\n\t// behavior of NVDA 2020.2/Firefox 81 and iOS VoiceOver/Safari 13.6.\n\tconst assignedNodes = slot.assignedNodes();\n\tif (assignedNodes.length === 0) {\n\t\t// if no nodes are assigned to the slot, it displays the default content\n\t\treturn ArrayFrom(slot.childNodes);\n\t}\n\treturn assignedNodes;\n}\n\n/**\n * implements https://w3c.github.io/accname/#mapping_additional_nd_te\n * @param root\n * @param options\n * @returns\n */\nexport function computeTextAlternative(\n\troot: Element,\n\toptions: ComputeTextAlternativeOptions = {},\n): string {\n\tconst consultedNodes = new SetLike<Node>();\n\tconst computedStyles =\n\t\ttypeof Map === \"undefined\"\n\t\t\t? undefined\n\t\t\t: new Map<Element, CSSStyleDeclaration>();\n\n\tconst window = safeWindow(root);\n\tconst {\n\t\tcompute = \"name\",\n\t\tcomputedStyleSupportsPseudoElements = options.getComputedStyle !==\n\t\t\tundefined,\n\t\t// This might be overengineered. I don't know what happens if I call\n\t\t// window.getComputedStyle(elementFromAnotherWindow) or if I don't bind it\n\t\t// the type declarations don't require a `this`\n\t\t// eslint-disable-next-line no-restricted-properties\n\t\tgetComputedStyle: uncachedGetComputedStyle = window.getComputedStyle.bind(\n\t\t\twindow,\n\t\t),\n\t\thidden = false,\n\t} = options;\n\tconst getComputedStyle: GetComputedStyle = (\n\t\tel,\n\t\tpseudoElement,\n\t): CSSStyleDeclaration => {\n\t\t// We don't cache the pseudoElement styles and calls with psuedo elements\n\t\t// should use the uncached version instead\n\t\tif (pseudoElement !== undefined) {\n\t\t\tthrow new Error(\n\t\t\t\t\"use uncachedGetComputedStyle directly for pseudo elements\",\n\t\t\t);\n\t\t}\n\t\t// If Map is not available, it is probably faster to just use the uncached\n\t\t// version since a polyfill lookup would be O(n) instead of O(1) and\n\t\t// the getComputedStyle function in those environments(e.g. IE11) is fast\n\t\tif (computedStyles === undefined) {\n\t\t\treturn uncachedGetComputedStyle(el);\n\t\t}\n\t\tconst cachedStyles = computedStyles.get(el);\n\t\tif (cachedStyles) {\n\t\t\treturn cachedStyles;\n\t\t}\n\t\tconst style = uncachedGetComputedStyle(el, pseudoElement);\n\t\tcomputedStyles.set(el, style);\n\t\treturn style;\n\t};\n\n\t// 2F.i\n\tfunction computeMiscTextAlternative(\n\t\tnode: Node,\n\t\tcontext: { isEmbeddedInLabel: boolean; isReferenced: boolean },\n\t): string {\n\t\tlet accumulatedText = \"\";\n\t\tif (isElement(node) && computedStyleSupportsPseudoElements) {\n\t\t\tconst pseudoBefore = uncachedGetComputedStyle(node, \"::before\");\n\t\t\tconst beforeContent = getTextualContent(pseudoBefore);\n\t\t\taccumulatedText = `${beforeContent} ${accumulatedText}`;\n\t\t}\n\n\t\t// FIXME: Including aria-owns is not defined in the spec\n\t\t// But it is required in the web-platform-test\n\t\tconst childNodes = isHTMLSlotElement(node)\n\t\t\t? getSlotContents(node)\n\t\t\t: ArrayFrom(node.childNodes).concat(queryIdRefs(node, \"aria-owns\"));\n\t\tchildNodes.forEach((child) => {\n\t\t\tconst result = computeTextAlternative(child, {\n\t\t\t\tisEmbeddedInLabel: context.isEmbeddedInLabel,\n\t\t\t\tisReferenced: false,\n\t\t\t\trecursion: true,\n\t\t\t});\n\t\t\t// TODO: Unclear why display affects delimiter\n\t\t\t// see https://github.com/w3c/accname/issues/3\n\t\t\tconst display = isElement(child)\n\t\t\t\t? getComputedStyle(child).getPropertyValue(\"display\")\n\t\t\t\t: \"inline\";\n\t\t\tconst separator = display !== \"inline\" ? \" \" : \"\";\n\t\t\t// trailing separator for wpt tests\n\t\t\taccumulatedText += `${separator}${result}${separator}`;\n\t\t});\n\t\tif (isElement(node) && computedStyleSupportsPseudoElements) {\n\t\t\tconst pseudoAfter = uncachedGetComputedStyle(node, \"::after\");\n\t\t\tconst afterContent = getTextualContent(pseudoAfter);\n\t\t\taccumulatedText = `${accumulatedText} ${afterContent}`;\n\t\t}\n\n\t\treturn accumulatedText.trim();\n\t}\n\n\t/**\n\t *\n\t * @param element\n\t * @param attributeName\n\t * @returns A string non-empty string or `null`\n\t */\n\tfunction useAttribute(\n\t\telement: Element,\n\t\tattributeName: string,\n\t): string | null {\n\t\tconst attribute = element.getAttributeNode(attributeName);\n\t\tif (\n\t\t\tattribute !== null &&\n\t\t\t!consultedNodes.has(attribute) &&\n\t\t\tattribute.value.trim() !== \"\"\n\t\t) {\n\t\t\tconsultedNodes.add(attribute);\n\t\t\treturn attribute.value;\n\t\t}\n\t\treturn null;\n\t}\n\n\tfunction computeTooltipAttributeValue(node: Node): string | null {\n\t\tif (!isElement(node)) {\n\t\t\treturn null;\n\t\t}\n\n\t\treturn useAttribute(node, \"title\");\n\t}\n\n\tfunction computeElementTextAlternative(node: Node): string | null {\n\t\tif (!isElement(node)) {\n\t\t\treturn null;\n\t\t}\n\n\t\t// https://w3c.github.io/html-aam/#fieldset-and-legend-elements\n\t\tif (isHTMLFieldSetElement(node)) {\n\t\t\tconsultedNodes.add(node);\n\t\t\tconst children = ArrayFrom(node.childNodes);\n\t\t\tfor (let i = 0; i < children.length; i += 1) {\n\t\t\t\tconst child = children[i];\n\t\t\t\tif (isHTMLLegendElement(child)) {\n\t\t\t\t\treturn computeTextAlternative(child, {\n\t\t\t\t\t\tisEmbeddedInLabel: false,\n\t\t\t\t\t\tisReferenced: false,\n\t\t\t\t\t\trecursion: false,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t} else if (isHTMLTableElement(node)) {\n\t\t\t// https://w3c.github.io/html-aam/#table-element\n\t\t\tconsultedNodes.add(node);\n\t\t\tconst children = ArrayFrom(node.childNodes);\n\t\t\tfor (let i = 0; i < children.length; i += 1) {\n\t\t\t\tconst child = children[i];\n\t\t\t\tif (isHTMLTableCaptionElement(child)) {\n\t\t\t\t\treturn computeTextAlternative(child, {\n\t\t\t\t\t\tisEmbeddedInLabel: false,\n\t\t\t\t\t\tisReferenced: false,\n\t\t\t\t\t\trecursion: false,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t} else if (isSVGSVGElement(node)) {\n\t\t\t// https://www.w3.org/TR/svg-aam-1.0/\n\t\t\tconsultedNodes.add(node);\n\t\t\tconst children = ArrayFrom(node.childNodes);\n\t\t\tfor (let i = 0; i < children.length; i += 1) {\n\t\t\t\tconst child = children[i];\n\t\t\t\tif (isSVGTitleElement(child)) {\n\t\t\t\t\treturn child.textContent;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn null;\n\t\t} else if (getLocalName(node) === \"img\" || getLocalName(node) === \"area\") {\n\t\t\t// https://w3c.github.io/html-aam/#area-element\n\t\t\t// https://w3c.github.io/html-aam/#img-element\n\t\t\tconst nameFromAlt = useAttribute(node, \"alt\");\n\t\t\tif (nameFromAlt !== null) {\n\t\t\t\treturn nameFromAlt;\n\t\t\t}\n\t\t} else if (isHTMLOptGroupElement(node)) {\n\t\t\tconst nameFromLabel = useAttribute(node, \"label\");\n\t\t\tif (nameFromLabel !== null) {\n\t\t\t\treturn nameFromLabel;\n\t\t\t}\n\t\t}\n\n\t\tif (\n\t\t\tisHTMLInputElement(node) &&\n\t\t\t(node.type === \"button\" ||\n\t\t\t\tnode.type === \"submit\" ||\n\t\t\t\tnode.type === \"reset\")\n\t\t) {\n\t\t\t// https://w3c.github.io/html-aam/#input-type-text-input-type-password-input-type-search-input-type-tel-input-type-email-input-type-url-and-textarea-element-accessible-description-computation\n\t\t\tconst nameFromValue = useAttribute(node, \"value\");\n\t\t\tif (nameFromValue !== null) {\n\t\t\t\treturn nameFromValue;\n\t\t\t}\n\n\t\t\t// TODO: l10n\n\t\t\tif (node.type === \"submit\") {\n\t\t\t\treturn \"Submit\";\n\t\t\t}\n\t\t\t// TODO: l10n\n\t\t\tif (node.type === \"reset\") {\n\t\t\t\treturn \"Reset\";\n\t\t\t}\n\t\t}\n\n\t\tconst labels = getLabels(node);\n\t\tif (labels !== null && labels.length !== 0) {\n\t\t\tconsultedNodes.add(node);\n\t\t\treturn ArrayFrom(labels)\n\t\t\t\t.map((element) => {\n\t\t\t\t\treturn computeTextAlternative(element, {\n\t\t\t\t\t\tisEmbeddedInLabel: true,\n\t\t\t\t\t\tisReferenced: false,\n\t\t\t\t\t\trecursion: true,\n\t\t\t\t\t});\n\t\t\t\t})\n\t\t\t\t.filter((label) => {\n\t\t\t\t\treturn label.length > 0;\n\t\t\t\t})\n\t\t\t\t.join(\" \");\n\t\t}\n\n\t\t// https://w3c.github.io/html-aam/#input-type-image-accessible-name-computation\n\t\t// TODO: wpt test consider label elements but html-aam does not mention them\n\t\t// We follow existing implementations over spec\n\t\tif (isHTMLInputElement(node) && node.type === \"image\") {\n\t\t\tconst nameFromAlt = useAttribute(node, \"alt\");\n\t\t\tif (nameFromAlt !== null) {\n\t\t\t\treturn nameFromAlt;\n\t\t\t}\n\n\t\t\tconst nameFromTitle = useAttribute(node, \"title\");\n\t\t\tif (nameFromTitle !== null) {\n\t\t\t\treturn nameFromTitle;\n\t\t\t}\n\n\t\t\t// TODO: l10n\n\t\t\treturn \"Submit Query\";\n\t\t}\n\n\t\tif (hasAnyConcreteRoles(node, [\"button\"])) {\n\t\t\t// https://www.w3.org/TR/html-aam-1.0/#button-element\n\t\t\tconst nameFromSubTree = computeMiscTextAlternative(node, {\n\t\t\t\tisEmbeddedInLabel: false,\n\t\t\t\tisReferenced: false,\n\t\t\t});\n\t\t\tif (nameFromSubTree !== \"\") {\n\t\t\t\treturn nameFromSubTree;\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tfunction computeTextAlternative(\n\t\tcurrent: Node,\n\t\tcontext: {\n\t\t\tisEmbeddedInLabel: boolean;\n\t\t\tisReferenced: boolean;\n\t\t\trecursion: boolean;\n\t\t},\n\t): string {\n\t\tif (consultedNodes.has(current)) {\n\t\t\treturn \"\";\n\t\t}\n\t\t// 2A\n\t\tif (\n\t\t\t!hidden &&\n\t\t\tisHidden(current, getComputedStyle) &&\n\t\t\t!context.isReferenced\n\t\t) {\n\t\t\tconsultedNodes.add(current);\n\t\t\treturn \"\" as FlatString;\n\t\t}\n\n\t\t// 2B\n\t\tconst labelAttributeNode = isElement(current)\n\t\t\t? current.getAttributeNode(\"aria-labelledby\")\n\t\t\t: null;\n\t\t// TODO: Do we generally need to block query IdRefs of attributes we have already consulted?\n\t\tconst labelElements =\n\t\t\tlabelAttributeNode !== null && !consultedNodes.has(labelAttributeNode)\n\t\t\t\t? queryIdRefs(current, \"aria-labelledby\")\n\t\t\t\t: [];\n\t\tif (\n\t\t\tcompute === \"name\" &&\n\t\t\t!context.isReferenced &&\n\t\t\tlabelElements.length > 0\n\t\t) {\n\t\t\t// eslint-disable-next-line @typescript-eslint/no-non-null-assertion -- Can't be null here otherwise labelElements would be empty\n\t\t\tconsultedNodes.add(labelAttributeNode!);\n\n\t\t\treturn labelElements\n\t\t\t\t.map((element) => {\n\t\t\t\t\t// TODO: Chrome will consider repeated values i.e. use a node multiple times while we'll bail out in computeTextAlternative.\n\t\t\t\t\treturn computeTextAlternative(element, {\n\t\t\t\t\t\tisEmbeddedInLabel: context.isEmbeddedInLabel,\n\t\t\t\t\t\tisReferenced: true,\n\t\t\t\t\t\t// this isn't recursion as specified, otherwise we would skip\n\t\t\t\t\t\t// `aria-label` in\n\t\t\t\t\t\t// <input id=\"myself\" aria-label=\"foo\" aria-labelledby=\"myself\"\n\t\t\t\t\t\trecursion: false,\n\t\t\t\t\t});\n\t\t\t\t})\n\t\t\t\t.join(\" \");\n\t\t}\n\n\t\t// 2C\n\t\t// Changed from the spec in anticipation of https://github.com/w3c/accname/issues/64\n\t\t// spec says we should only consider skipping if we have a non-empty label\n\t\tconst skipToStep2E =\n\t\t\tcontext.recursion && isControl(current) && compute === \"name\";\n\t\tif (!skipToStep2E) {\n\t\t\tconst ariaLabel = (\n\t\t\t\t(isElement(current) && current.getAttribute(\"aria-label\")) ||\n\t\t\t\t\"\"\n\t\t\t).trim();\n\t\t\tif (ariaLabel !== \"\" && compute === \"name\") {\n\t\t\t\tconsultedNodes.add(current);\n\t\t\t\treturn ariaLabel;\n\t\t\t}\n\n\t\t\t// 2D\n\t\t\tif (!isMarkedPresentational(current)) {\n\t\t\t\tconst elementTextAlternative = computeElementTextAlternative(current);\n\t\t\t\tif (elementTextAlternative !== null) {\n\t\t\t\t\tconsultedNodes.add(current);\n\t\t\t\t\treturn elementTextAlternative;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// special casing, cheating to make tests pass\n\t\t// https://github.com/w3c/accname/issues/67\n\t\tif (hasAnyConcreteRoles(current, [\"menu\"])) {\n\t\t\tconsultedNodes.add(current);\n\t\t\treturn \"\";\n\t\t}\n\n\t\t// 2E\n\t\tif (skipToStep2E || context.isEmbeddedInLabel || context.isReferenced) {\n\t\t\tif (hasAnyConcreteRoles(current, [\"combobox\", \"listbox\"])) {\n\t\t\t\tconsultedNodes.add(current);\n\t\t\t\tconst selectedOptions = querySelectedOptions(current);\n\t\t\t\tif (selectedOptions.length === 0) {\n\t\t\t\t\t// defined per test `name_heading_combobox`\n\t\t\t\t\treturn isHTMLInputElement(current) ? current.value : \"\";\n\t\t\t\t}\n\t\t\t\treturn ArrayFrom(selectedOptions)\n\t\t\t\t\t.map((selectedOption) => {\n\t\t\t\t\t\treturn computeTextAlternative(selectedOption, {\n\t\t\t\t\t\t\tisEmbeddedInLabel: context.isEmbeddedInLabel,\n\t\t\t\t\t\t\tisReferenced: false,\n\t\t\t\t\t\t\trecursion: true,\n\t\t\t\t\t\t});\n\t\t\t\t\t})\n\t\t\t\t\t.join(\" \");\n\t\t\t}\n\t\t\tif (hasAbstractRole(current, \"range\")) {\n\t\t\t\tconsultedNodes.add(current);\n\t\t\t\tif (current.hasAttribute(\"aria-valuetext\")) {\n\t\t\t\t\t// eslint-disable-next-line @typescript-eslint/no-non-null-assertion -- safe due to hasAttribute guard\n\t\t\t\t\treturn current.getAttribute(\"aria-valuetext\")!;\n\t\t\t\t}\n\t\t\t\tif (current.hasAttribute(\"aria-valuenow\")) {\n\t\t\t\t\t// eslint-disable-next-line @typescript-eslint/no-non-null-assertion -- safe due to hasAttribute guard\n\t\t\t\t\treturn current.getAttribute(\"aria-valuenow\")!;\n\t\t\t\t}\n\t\t\t\t// Otherwise, use the value as specified by a host language attribute.\n\t\t\t\treturn current.getAttribute(\"value\") || \"\";\n\t\t\t}\n\t\t\tif (hasAnyConcreteRoles(current, [\"textbox\"])) {\n\t\t\t\tconsultedNodes.add(current);\n\t\t\t\treturn getValueOfTextbox(current);\n\t\t\t}\n\t\t}\n\n\t\t// 2F: https://w3c.github.io/accname/#step2F\n\t\tif (\n\t\t\tallowsNameFromContent(current) ||\n\t\t\t(isElement(current) && context.isReferenced) ||\n\t\t\tisNativeHostLanguageTextAlternativeElement(current) ||\n\t\t\tisDescendantOfNativeHostLanguageTextAlternativeElement(current)\n\t\t) {\n\t\t\tconst accumulatedText2F = computeMiscTextAlternative(current, {\n\t\t\t\tisEmbeddedInLabel: context.isEmbeddedInLabel,\n\t\t\t\tisReferenced: false,\n\t\t\t});\n\t\t\tif (accumulatedText2F !== \"\") {\n\t\t\t\tconsultedNodes.add(current);\n\t\t\t\treturn accumulatedText2F;\n\t\t\t}\n\t\t}\n\n\t\tif (current.nodeType === current.TEXT_NODE) {\n\t\t\tconsultedNodes.add(current);\n\t\t\treturn current.textContent || \"\";\n\t\t}\n\n\t\tif (context.recursion) {\n\t\t\tconsultedNodes.add(current);\n\t\t\treturn computeMiscTextAlternative(current, {\n\t\t\t\tisEmbeddedInLabel: context.isEmbeddedInLabel,\n\t\t\t\tisReferenced: false,\n\t\t\t});\n\t\t}\n\n\t\tconst tooltipAttributeValue = computeTooltipAttributeValue(current);\n\t\tif (tooltipAttributeValue !== null) {\n\t\t\tconsultedNodes.add(current);\n\t\t\treturn tooltipAttributeValue;\n\t\t}\n\n\t\t// TODO should this be reachable?\n\t\tconsultedNodes.add(current);\n\t\treturn \"\";\n\t}\n\n\treturn asFlatString(\n\t\tcomputeTextAlternative(root, {\n\t\t\tisEmbeddedInLabel: false,\n\t\t\t// by spec computeAccessibleDescription starts with the referenced elements as roots\n\t\t\tisReferenced: compute === \"description\",\n\t\t\trecursion: false,\n\t\t}),\n\t);\n}\n"],"mappings":"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","ignoreList":[]}