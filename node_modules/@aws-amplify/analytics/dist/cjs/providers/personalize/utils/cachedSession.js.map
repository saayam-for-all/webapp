{"version":3,"file":"cachedSession.js","sources":["../../../../../src/providers/personalize/utils/cachedSession.ts"],"sourcesContent":["\"use strict\";\n// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: Apache-2.0\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.updateCachedSession = exports.resolveCachedSession = void 0;\nconst core_1 = require(\"@aws-amplify/core\");\nconst utils_1 = require(\"@aws-amplify/core/internals/utils\");\nconst PERSONALIZE_CACHE_USERID = '_awsct_uid';\nconst PERSONALIZE_CACHE_SESSIONID = '_awsct_sid';\nconst DEFAULT_CACHE_PREFIX = 'personalize';\nconst DELIMITER = '.';\nconst CACHE_EXPIRY_IN_DAYS = 7;\nconst normalize = (key) => [key, (0, utils_1.isBrowser)() ? window.location.host : DEFAULT_CACHE_PREFIX].join(DELIMITER);\nconst getCache = (key) => core_1.Cache.getItem(normalize(key));\nconst setCache = (key, value) => {\n    const expiredAt = new Date(Date.now() + 3600000 * 24 * CACHE_EXPIRY_IN_DAYS);\n    core_1.Cache.setItem(normalize(key), value, {\n        expires: expiredAt.getTime(),\n    });\n};\nconst resolveCachedSession = async () => {\n    let sessionId = await getCache(PERSONALIZE_CACHE_SESSIONID);\n    if (!sessionId) {\n        sessionId = (0, utils_1.amplifyUuid)();\n        setCache(PERSONALIZE_CACHE_SESSIONID, sessionId);\n    }\n    const userId = await getCache(PERSONALIZE_CACHE_USERID);\n    return {\n        sessionId,\n        userId,\n    };\n};\nexports.resolveCachedSession = resolveCachedSession;\nconst updateCachedSession = (newUserId, currentSessionId, currentUserId) => {\n    const isNoCachedSession = !currentSessionId;\n    const isSignOutCase = !newUserId && !currentUserId;\n    const isSwitchUserCase = !!newUserId && !!currentUserId && newUserId !== currentUserId;\n    const isRequireNewSession = isNoCachedSession || isSignOutCase || isSwitchUserCase;\n    const isRequireUpdateSession = !!currentSessionId && !currentUserId && !!newUserId;\n    if (isRequireNewSession) {\n        const newSessionId = (0, utils_1.amplifyUuid)();\n        setCache(PERSONALIZE_CACHE_SESSIONID, newSessionId);\n        setCache(PERSONALIZE_CACHE_USERID, newUserId);\n    }\n    else if (isRequireUpdateSession) {\n        setCache(PERSONALIZE_CACHE_USERID, newUserId);\n    }\n};\nexports.updateCachedSession = updateCachedSession;\n"],"names":[],"mappings":"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"}