{"version":3,"file":"syncMessages.js","sources":["../../../../../../src/inAppMessaging/providers/pinpoint/apis/syncMessages.ts"],"sourcesContent":["\"use strict\";\n// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: Apache-2.0\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.syncMessages = void 0;\nconst utils_1 = require(\"@aws-amplify/core/internals/utils\");\nconst pinpoint_1 = require(\"@aws-amplify/core/internals/providers/pinpoint\");\nconst core_1 = require(\"@aws-amplify/core\");\nconst pinpoint_2 = require(\"@aws-amplify/core/internals/aws-clients/pinpoint\");\nconst utils_2 = require(\"../utils\");\nconst errors_1 = require(\"../../../errors\");\nconst utils_3 = require(\"../../../utils\");\n/**\n * Fetch and persist messages from Pinpoint campaigns.\n * Calling this API is necessary to trigger InApp messages on the device.\n *\n * @throws service exceptions - Thrown when the underlying Pinpoint service returns an error.\n * @throws validation: {@link InAppMessagingValidationErrorCode} - Thrown when the provided parameters or library\n * configuration is incorrect, or if In App messaging hasn't been initialized.\n * @returns A promise that will resolve when the operation is complete.\n * @example\n * ```ts\n * // Sync InApp messages with Pinpoint and device.\n * await syncMessages();\n *\n * ```\n */\nasync function syncMessages() {\n    (0, utils_3.assertIsInitialized)();\n    const messages = await fetchInAppMessages();\n    if (!messages || messages.length === 0) {\n        return;\n    }\n    try {\n        const key = `${utils_2.PINPOINT_KEY_PREFIX}${utils_2.STORAGE_KEY_SUFFIX}`;\n        await core_1.defaultStorage.setItem(key, JSON.stringify(messages));\n    }\n    catch (error) {\n        (0, errors_1.assertServiceError)(error);\n        throw error;\n    }\n}\nexports.syncMessages = syncMessages;\nasync function fetchInAppMessages() {\n    try {\n        const { credentials, identityId } = await (0, utils_2.resolveCredentials)();\n        const { appId, region } = (0, utils_2.resolveConfig)();\n        const endpointId = await (0, pinpoint_1.resolveEndpointId)({\n            appId,\n            category: utils_2.CATEGORY,\n            channelType: utils_2.CHANNEL_TYPE,\n            credentials,\n            identityId,\n            region,\n            userAgentValue: (0, utils_2.getInAppMessagingUserAgentString)(utils_1.InAppMessagingAction.SyncMessages),\n        });\n        const input = {\n            ApplicationId: appId,\n            EndpointId: endpointId,\n        };\n        const response = await (0, pinpoint_2.getInAppMessages)({ credentials, region }, input);\n        const { InAppMessageCampaigns: messages } = response.InAppMessagesResponse ?? {};\n        return messages;\n    }\n    catch (error) {\n        (0, errors_1.assertServiceError)(error);\n        throw error;\n    }\n}\n"],"names":[],"mappings":"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"}