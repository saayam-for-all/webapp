{"version":3,"file":"getDataChunker.js","sources":["../../../../../../../../src/providers/s3/apis/internal/uploadData/multipart/getDataChunker.ts"],"sourcesContent":["\"use strict\";\n// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: Apache-2.0\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.getDataChunker = void 0;\nconst validation_1 = require(\"../../../../../../errors/types/validation\");\nconst StorageError_1 = require(\"../../../../../../errors/StorageError\");\nconst calculatePartSize_1 = require(\"./calculatePartSize\");\nconst getDataChunker = (data, totalSize) => {\n    const partSize = (0, calculatePartSize_1.calculatePartSize)(totalSize);\n    if (data instanceof Blob) {\n        return helper(data, 0, data.size, partSize);\n    }\n    else if (ArrayBuffer.isView(data)) {\n        return helper(data.buffer, data.byteOffset, data.byteLength, partSize);\n    }\n    else if (data instanceof ArrayBuffer) {\n        return helper(data, 0, data.byteLength, partSize);\n    }\n    else if (typeof data === 'string') {\n        const blob = new Blob([data]);\n        return (0, exports.getDataChunker)(blob, blob.size);\n    }\n    else {\n        throw new StorageError_1.StorageError({\n            name: validation_1.StorageValidationErrorCode.InvalidUploadSource,\n            ...validation_1.validationErrorMap[validation_1.StorageValidationErrorCode.InvalidUploadSource],\n        });\n    }\n};\nexports.getDataChunker = getDataChunker;\nconst helper = function* (buffer, byteOffset, byteLength, partSize) {\n    let partNumber = 1;\n    let startByte = byteOffset;\n    let endByte = byteOffset + Math.min(partSize, byteLength);\n    while (endByte < byteLength + byteOffset) {\n        yield {\n            partNumber,\n            data: buffer.slice(startByte, endByte),\n            size: partSize,\n        };\n        partNumber += 1;\n        startByte = endByte;\n        endByte = startByte + partSize;\n    }\n    yield {\n        partNumber,\n        data: buffer.slice(startByte, byteLength + byteOffset),\n        size: byteLength + byteOffset - startByte,\n    };\n};\n"],"names":[],"mappings":";;AACA;AACA;AACA,MAAM,CAAC,cAAc,CAAC,OAAO,EAAE,YAAY,EAAE,EAAE,KAAK,EAAE,IAAI,EAAE,CAAC,CAAC;AAC9D,OAAO,CAAC,cAAc,GAAG,KAAK,CAAC,CAAC;AAChC,MAAM,YAAY,GAAG,OAAO,CAAC,2CAA2C,CAAC,CAAC;AAC1E,MAAM,cAAc,GAAG,OAAO,CAAC,uCAAuC,CAAC,CAAC;AACxE,MAAM,mBAAmB,GAAG,OAAO,CAAC,qBAAqB,CAAC,CAAC;AAC3D,MAAM,cAAc,GAAG,CAAC,IAAI,EAAE,SAAS,KAAK;AAC5C,IAAI,MAAM,QAAQ,GAAG,IAAI,mBAAmB,CAAC,iBAAiB,EAAE,SAAS,CAAC,CAAC;AAC3E,IAAI,IAAI,IAAI,YAAY,IAAI,EAAE;AAC9B,QAAQ,OAAO,MAAM,CAAC,IAAI,EAAE,CAAC,EAAE,IAAI,CAAC,IAAI,EAAE,QAAQ,CAAC,CAAC;AACpD,KAAK;AACL,SAAS,IAAI,WAAW,CAAC,MAAM,CAAC,IAAI,CAAC,EAAE;AACvC,QAAQ,OAAO,MAAM,CAAC,IAAI,CAAC,MAAM,EAAE,IAAI,CAAC,UAAU,EAAE,IAAI,CAAC,UAAU,EAAE,QAAQ,CAAC,CAAC;AAC/E,KAAK;AACL,SAAS,IAAI,IAAI,YAAY,WAAW,EAAE;AAC1C,QAAQ,OAAO,MAAM,CAAC,IAAI,EAAE,CAAC,EAAE,IAAI,CAAC,UAAU,EAAE,QAAQ,CAAC,CAAC;AAC1D,KAAK;AACL,SAAS,IAAI,OAAO,IAAI,KAAK,QAAQ,EAAE;AACvC,QAAQ,MAAM,IAAI,GAAG,IAAI,IAAI,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC;AACtC,QAAQ,OAAO,IAAI,OAAO,CAAC,cAAc,EAAE,IAAI,EAAE,IAAI,CAAC,IAAI,CAAC,CAAC;AAC5D,KAAK;AACL,SAAS;AACT,QAAQ,MAAM,IAAI,cAAc,CAAC,YAAY,CAAC;AAC9C,YAAY,IAAI,EAAE,YAAY,CAAC,0BAA0B,CAAC,mBAAmB;AAC7E,YAAY,GAAG,YAAY,CAAC,kBAAkB,CAAC,YAAY,CAAC,0BAA0B,CAAC,mBAAmB,CAAC;AAC3G,SAAS,CAAC,CAAC;AACX,KAAK;AACL,CAAC,CAAC;AACF,OAAO,CAAC,cAAc,GAAG,cAAc,CAAC;AACxC,MAAM,MAAM,GAAG,WAAW,MAAM,EAAE,UAAU,EAAE,UAAU,EAAE,QAAQ,EAAE;AACpE,IAAI,IAAI,UAAU,GAAG,CAAC,CAAC;AACvB,IAAI,IAAI,SAAS,GAAG,UAAU,CAAC;AAC/B,IAAI,IAAI,OAAO,GAAG,UAAU,GAAG,IAAI,CAAC,GAAG,CAAC,QAAQ,EAAE,UAAU,CAAC,CAAC;AAC9D,IAAI,OAAO,OAAO,GAAG,UAAU,GAAG,UAAU,EAAE;AAC9C,QAAQ,MAAM;AACd,YAAY,UAAU;AACtB,YAAY,IAAI,EAAE,MAAM,CAAC,KAAK,CAAC,SAAS,EAAE,OAAO,CAAC;AAClD,YAAY,IAAI,EAAE,QAAQ;AAC1B,SAAS,CAAC;AACV,QAAQ,UAAU,IAAI,CAAC,CAAC;AACxB,QAAQ,SAAS,GAAG,OAAO,CAAC;AAC5B,QAAQ,OAAO,GAAG,SAAS,GAAG,QAAQ,CAAC;AACvC,KAAK;AACL,IAAI,MAAM;AACV,QAAQ,UAAU;AAClB,QAAQ,IAAI,EAAE,MAAM,CAAC,KAAK,CAAC,SAAS,EAAE,UAAU,GAAG,UAAU,CAAC;AAC9D,QAAQ,IAAI,EAAE,UAAU,GAAG,UAAU,GAAG,SAAS;AACjD,KAAK,CAAC;AACN,CAAC;;"}