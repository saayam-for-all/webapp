{"version":3,"file":"generateClient.mjs","sources":["../../../src/server/generateClient.ts"],"sourcesContent":["// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: Apache-2.0\nimport { getAmplifyServerContext, } from '@aws-amplify/core/internals/adapter-core';\nimport { generateClientWithAmplifyInstance } from '../internals/server';\nimport { __amplify, } from '../types';\n/**\n * Generates an GraphQL API client that works with Amplify server context.\n *\n * @example\n * import config from './amplifyconfiguration.json';\n * import { listPosts } from './graphql/queries';\n *\n * const client = generateServerClient({ config });\n *\n * const result = await runWithAmplifyServerContext({\n *   nextServerContext: { request, response },\n *   operation: (contextSpec) => client.graphql(contextSpec, {\n *     query: listPosts,\n *   }),\n * });\n */\nexport function generateClient(options) {\n    // passing `null` instance because each (future model) method must retrieve a valid instance\n    // from server context\n    const client = generateClientWithAmplifyInstance({\n        amplify: null,\n        ...options,\n    });\n    // TODO: improve this and the next type\n    const prevGraphql = client.graphql;\n    const wrappedGraphql = (contextSpec, innerOptions, additionalHeaders) => {\n        const amplifyInstance = getAmplifyServerContext(contextSpec).amplify;\n        return prevGraphql.call({ [__amplify]: amplifyInstance }, innerOptions, additionalHeaders);\n    };\n    client.graphql = wrappedGraphql;\n    return client;\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO,SAAS,cAAc,CAAC,OAAO,EAAE;AACxC;AACA;AACA,IAAI,MAAM,MAAM,GAAG,iCAAiC,CAAC;AACrD,QAAQ,OAAO,EAAE,IAAI;AACrB,QAAQ,GAAG,OAAO;AAClB,KAAK,CAAC,CAAC;AACP;AACA,IAAI,MAAM,WAAW,GAAG,MAAM,CAAC,OAAO,CAAC;AACvC,IAAI,MAAM,cAAc,GAAG,CAAC,WAAW,EAAE,YAAY,EAAE,iBAAiB,KAAK;AAC7E,QAAQ,MAAM,eAAe,GAAG,uBAAuB,CAAC,WAAW,CAAC,CAAC,OAAO,CAAC;AAC7E,QAAQ,OAAO,WAAW,CAAC,IAAI,CAAC,EAAE,CAAC,SAAS,GAAG,eAAe,EAAE,EAAE,YAAY,EAAE,iBAAiB,CAAC,CAAC;AACnG,KAAK,CAAC;AACN,IAAI,MAAM,CAAC,OAAO,GAAG,cAAc,CAAC;AACpC,IAAI,OAAO,MAAM,CAAC;AAClB;;;;"}